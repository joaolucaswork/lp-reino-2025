# üöÄ Guia de Configura√ß√£o do Typebot

## ‚ö†Ô∏è IMPORTANTE: Configura√ß√£o Necess√°ria no Typebot

Para que a funcionalidade de substitui√ß√£o de nome funcione, **voc√™ PRECISA adicionar um bloco de Script no seu Typebot**. O Typebot n√£o envia eventos `postMessage` automaticamente.

---

## üìã Passo a Passo

### 1. Acesse o Editor do Typebot

1. Acesse: <https://typebot.io>
2. Fa√ßa login na sua conta
3. Abra o Typebot: `captura-landing-page-7sjfh99`

### 2. Adicione um Bloco de Script

#### Op√ß√£o A: Enviar Nome em Tempo Real (Recomendado)

Adicione um bloco de **Script** logo **AP√ìS** o campo onde o usu√°rio digita o nome:

```javascript
// Enviar o nome assim que for capturado
// IMPORTANTE: Use {{nome}} SEM aspas para obter o valor real
if (typeof {{nome}} !== 'undefined' && {{nome}} !== null && {{nome}} !== '') {
  const nomeValue = {{nome}};

  window.parent.postMessage({
    type: 'typebot-variable-update',
    variable: 'nome',
    value: nomeValue
  }, '*');

  console.log('Nome enviado:', nomeValue);
}
```

**Onde adicionar:**

```
[Pergunta: Qual √© o seu nome?]
        ‚Üì
[Input: nome]
        ‚Üì
[Script: Enviar nome] ‚Üê ADICIONE AQUI
        ‚Üì
[Pr√≥xima pergunta...]
```

#### Op√ß√£o B: Enviar Todos os Dados no Final

Adicione um bloco de **Script** no **FINAL** do fluxo do Typebot:

```javascript
// Enviar todos os dados quando o usu√°rio completar o formul√°rio
// IMPORTANTE: Use {{variavel}} SEM aspas para obter os valores reais
const nomeValue = {{nome}};
const emailValue = {{email}};
const telefoneValue = {{telefone}};

window.parent.postMessage({
  type: 'typebot-completion',
  data: {
    nome: nomeValue,
    email: emailValue,
    telefone: telefoneValue,
    completed: true,
    timestamp: new Date().toISOString()
  }
}, '*');

console.log('Typebot completado!', { nome: nomeValue, email: emailValue });
```

**Onde adicionar:**

```
[√öltima pergunta]
        ‚Üì
[Mensagem de agradecimento]
        ‚Üì
[Script: Enviar dados] ‚Üê ADICIONE AQUI
```

#### Op√ß√£o C: Ambos (Melhor Experi√™ncia)

Para a melhor experi√™ncia do usu√°rio, use **AMBAS** as op√ß√µes:

1. **Script ap√≥s o campo "nome"** - Para atualiza√ß√£o em tempo real
2. **Script no final** - Para capturar todos os dados

---

## üéØ Configura√ß√£o Recomendada

### Script 1: Ap√≥s o Campo "Nome"

**Localiza√ß√£o:** Logo ap√≥s o input do nome

```javascript
// Atualizar o nome e ID na p√°gina em tempo real
// IMPORTANTE: Use {{nome}} SEM aspas para valor, COM aspas para ID!
if (typeof {{nome}} !== 'undefined' && {{nome}} !== null && {{nome}} !== '') {
  const nomeValue = {{nome}};    // SEM aspas = valor real
  const nomeId = '{{nome}}';     // COM aspas = ID da vari√°vel

  window.parent.postMessage({
    type: 'typebot-variable-update',
    variable: 'nome',
    value: nomeValue,
    variableId: nomeId  // Enviar o ID tamb√©m
  }, '*');

  console.log('Nome enviado:', nomeValue);
  console.log('ID da vari√°vel:', nomeId);
}
```

### Script 2: No Final do Fluxo

**Localiza√ß√£o:** √öltimo bloco do Typebot

```javascript
// Enviar todos os dados coletados
// IMPORTANTE: Use {{variavel}} SEM aspas para valor, COM aspas para ID!
const nomeValue = {{nome}};           // SEM aspas = valor
const nomeId = '{{nome}}';            // COM aspas = ID
const emailValue = {{email}};
const telefoneValue = {{telefone}};
const patrimonioValue = {{patrimonio}};

window.parent.postMessage({
  type: 'typebot-completion',
  data: {
    nome: nomeValue,
    userId: nomeId,  // Enviar o ID do usu√°rio
    email: emailValue,
    telefone: telefoneValue,
    patrimonio: patrimonioValue,
    completed: true,
    timestamp: new Date().toISOString()
  }
}, '*');

console.log('Typebot completado com sucesso!');
console.log('Dados:', { nome: nomeValue, userId: nomeId, email: emailValue });
```

---

## üîç Como Adicionar um Bloco de Script no Typebot

### Passo 1: Abra o Editor

1. No dashboard do Typebot, clique no seu bot
2. Clique em "Edit" para abrir o editor visual

### Passo 2: Adicione o Bloco

1. Clique no bot√£o **"+"** onde voc√™ quer adicionar o script
2. Procure por **"Script"** ou **"Code"**
3. Selecione o bloco de **Script**

### Passo 3: Cole o C√≥digo

1. Cole um dos c√≥digos acima no editor de script
2. Certifique-se de que as vari√°veis (ex: `{{nome}}`) correspondem √†s suas vari√°veis do Typebot

### Passo 4: Salve e Publique

1. Clique em **"Save"**
2. Clique em **"Publish"** para publicar as altera√ß√µes
3. Teste o fluxo

---

## ‚úÖ Verifica√ß√£o

### Como Testar se Est√° Funcionando

1. **Abra a p√°gina no navegador**
2. **Abra o Console do navegador** (F12 ‚Üí Console)
3. **Preencha o Typebot** com um nome
4. **Verifique no console** se aparecem as mensagens:

```
[TypebotNameReplacer] Typebot variable "nome" updated: Jo√£o Silva
[TypebotNameReplacer] User name updated to: Jo√£o Silva
[TypebotNameReplacer] Found 1 element(s) to update
[TypebotNameReplacer] Updated element: "******" -> "Jo√£o Silva"
```

5. **Verifique visualmente** se os asteriscos foram substitu√≠dos pelo nome

---

## üêõ Troubleshooting

### Problema: Asteriscos n√£o s√£o substitu√≠dos

**Poss√≠veis causas:**

1. ‚ùå Script n√£o foi adicionado no Typebot
2. ‚ùå Nome da vari√°vel est√° incorreto (deve ser `{{nome}}`)
3. ‚ùå Typebot n√£o foi publicado ap√≥s adicionar o script
4. ‚ùå Cache do navegador

**Solu√ß√µes:**

```javascript
// 1. Verifique se o script est√° correto no Typebot
// 2. Confirme que a vari√°vel se chama "nome" (n√£o "name" ou "Nome")
// 3. Publique o Typebot novamente
// 4. Limpe o cache do navegador (Ctrl+Shift+R ou Cmd+Shift+R)
```

### Problema: Console mostra erro "postMessage is not defined"

**Solu√ß√£o:**

Certifique-se de usar `window.parent.postMessage` (n√£o apenas `postMessage`):

```javascript
// ‚úÖ CORRETO
window.parent.postMessage({...}, '*');

// ‚ùå ERRADO
postMessage({...}, '*');
```

### Problema: Eventos n√£o s√£o capturados

**Solu√ß√£o:**

Verifique se o c√≥digo JavaScript foi compilado e est√° carregado:

```javascript
// No console do navegador, digite:
console.log(window.Webflow);

// Deve mostrar um array com fun√ß√µes
```

---

## üìä Estrutura Completa do Typebot

### Exemplo de Fluxo Recomendado

```
1. [Mensagem de Boas-vindas]
   "Ol√°! Vamos come√ßar?"
        ‚Üì
2. [Pergunta: Nome]
   "Qual √© o seu nome?"
        ‚Üì
3. [Input: nome]
   Vari√°vel: nome
        ‚Üì
4. [Script: Enviar Nome] ‚Üê ADICIONE ESTE SCRIPT
   window.parent.postMessage({
     type: 'typebot-variable-update',
     variable: 'nome',
     value: {{nome}}
   }, '*');
        ‚Üì
5. [Pergunta: Email]
   "Qual √© o seu email?"
        ‚Üì
6. [Input: email]
   Vari√°vel: email
        ‚Üì
7. [Pergunta: Telefone]
   "Qual √© o seu telefone?"
        ‚Üì
8. [Input: telefone]
   Vari√°vel: telefone
        ‚Üì
9. [Mensagem de Agradecimento]
   "Obrigado, {{nome}}!"
        ‚Üì
10. [Script: Enviar Dados Completos] ‚Üê ADICIONE ESTE SCRIPT
    window.parent.postMessage({
      type: 'typebot-completion',
      data: {
        nome: {{nome}},
        email: {{email}},
        telefone: {{telefone}},
        completed: true,
        timestamp: new Date().toISOString()
      }
    }, '*');
```

---

## üé® Vari√°veis Dispon√≠veis

Certifique-se de que estas vari√°veis existem no seu Typebot:

| Vari√°vel | Tipo | Obrigat√≥ria | Descri√ß√£o |
|----------|------|-------------|-----------|
| `nome` | Text | ‚úÖ Sim | Nome do usu√°rio |
| `email` | Email | ‚ö†Ô∏è Recomendado | Email do usu√°rio |
| `telefone` | Phone | ‚ö†Ô∏è Recomendado | Telefone do usu√°rio |
| `patrimonio` | Text | ‚ùå Opcional | Patrim√¥nio do investidor |

---

## üìù Checklist de Configura√ß√£o

Antes de testar em produ√ß√£o, verifique:

- [ ] Script adicionado ap√≥s o campo "nome"
- [ ] Script adicionado no final do fluxo
- [ ] Vari√°vel `{{nome}}` existe no Typebot
- [ ] Typebot foi salvo
- [ ] Typebot foi publicado
- [ ] C√≥digo JavaScript foi compilado (`pnpm build`)
- [ ] Arquivo `dist/index.js` foi atualizado no Webflow
- [ ] Cache do navegador foi limpo
- [ ] Testado em modo de desenvolvimento (console aberto)
- [ ] Testado em produ√ß√£o

---

## üöÄ Deploy no Webflow

### Passo 1: Build do Projeto

```bash
pnpm build
```

### Passo 2: Upload do Arquivo

1. Acesse o Webflow
2. V√° em **Settings** ‚Üí **Custom Code**
3. Fa√ßa upload do arquivo `dist/index.js`
4. Ou copie o conte√∫do e cole no **Footer Code**

### Passo 3: Publicar

1. Clique em **Publish**
2. Teste a p√°gina publicada

---

## üí° Dicas Avan√ßadas

### Enviar Eventos Personalizados

Voc√™ pode enviar eventos personalizados para outras funcionalidades:

```javascript
// Enviar evento quando o usu√°rio avan√ßa no fluxo
window.parent.postMessage({
  type: 'typebot-step-change',
  step: 'email-input',
  progress: 50
}, '*');

// Enviar evento de erro
window.parent.postMessage({
  type: 'typebot-error',
  error: 'Email inv√°lido'
}, '*');
```

### Integrar com Google Analytics

```javascript
// No script do Typebot
window.parent.postMessage({
  type: 'typebot-completion',
  data: {
    nome: {{nome}},
    email: {{email}}
  }
}, '*');

// Enviar para GA
if (window.gtag) {
  gtag('event', 'form_submission', {
    form_name: 'typebot_lead_capture',
    user_name: {{nome}}
  });
}
```

---

## üìû Suporte

Se voc√™ encontrar problemas:

1. **Verifique o console do navegador** para mensagens de erro
2. **Revise este guia** passo a passo
3. **Teste no ambiente de desenvolvimento** primeiro
4. **Consulte a documenta√ß√£o do Typebot**: <https://docs.typebot.io>

---

## ‚ú® Resumo

**O que voc√™ PRECISA fazer:**

1. ‚úÖ Adicionar bloco de **Script** no Typebot ap√≥s o campo "nome"
2. ‚úÖ Adicionar bloco de **Script** no final do fluxo do Typebot
3. ‚úÖ Publicar o Typebot
4. ‚úÖ Fazer build do projeto (`pnpm build`)
5. ‚úÖ Fazer upload do `dist/index.js` no Webflow
6. ‚úÖ Testar!

**O que N√ÉO precisa fazer:**

- ‚ùå Modificar o HTML do Webflow (j√° est√° correto)
- ‚ùå Adicionar bibliotecas extras
- ‚ùå Configurar webhooks
- ‚ùå Instalar plugins

---

**Pronto! Agora a funcionalidade vai funcionar perfeitamente! üéâ**
